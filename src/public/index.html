<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube é¢‘é“æœç´¢å·¥å…·</title>
  <link rel="stylesheet" href="https://unpkg.com/antd@4.24.15/dist/antd.css">
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div id="root"></div>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/antd@4.24.15/dist/antd.js"></script>
  
  <script type="text/babel">
    // æ£€æŸ¥ antd æ˜¯å¦æ­£ç¡®åŠ è½½
    if (typeof antd === 'undefined') {
      console.error('Antd æœªæ­£ç¡®åŠ è½½!');
      document.getElementById('root').innerHTML = '<div style="padding: 20px; color: red;">Antd åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
    } else {
      console.log('Antd åŠ è½½æˆåŠŸ:', Object.keys(antd));
    }
    
    const { useState, useEffect } = React;
    const { Input, Select, Button, Card, Spin, Tag, Space, Row, Col, Typography, Badge, message } = antd;
    const { Title, Paragraph, Text } = Typography;
    
    function App() {
      const [searchQuery, setSearchQuery] = useState('');
      const [searchType, setSearchType] = useState('1');
      const [loading, setLoading] = useState(false);
      const [results, setResults] = useState(null);
      const [expandedItems, setExpandedItems] = useState(new Set());
      
      const handleSearch = async () => {
        if (!searchQuery.trim()) {
          message.warning('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
          return;
        }
        
        setLoading(true);
        try {
          const response = await axios.get('/api/search/video', {
            params: {
              q: searchQuery,
              type: searchType
            }
          });
          setResults(response.data);
          message.success(`æœç´¢å®Œæˆï¼Œæ‰¾åˆ° ${response.data.results?.length || 0} ä¸ªé¢‘é“`);
        } catch (error) {
          console.error('æœç´¢å¤±è´¥:', error);
          message.error('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        } finally {
          setLoading(false);
        }
      };
      
      const toggleDescription = (index) => {
        const newExpanded = new Set(expandedItems);
        if (newExpanded.has(index)) {
          newExpanded.delete(index);
        } else {
          newExpanded.add(index);
        }
        setExpandedItems(newExpanded);
      };
      
      const formatNumber = (num) => {
        if (!num) return '0';
        const number = parseInt(num);
        if (number >= 1000000) {
          return (number / 1000000).toFixed(1) + 'M';
        }
        if (number >= 1000) {
          return (number / 1000).toFixed(1) + 'K';
        }
        return number.toString();
      };
      
      const renderChannelItem = (channel, index) => {
        const isExpanded = expandedItems.has(index);
        const hasDescription = channel.description && channel.description.length > 200;
        
        return (
          <Card 
            key={index}
            className="channel-card"
            style={{ marginBottom: 16 }}
            hoverable
          >
            <Title level={4} style={{ marginBottom: 16 }}>
              {channel.title}
            </Title>
            
            {channel.email && channel.email.length > 0 && (
              <div style={{ marginBottom: 16 }}>
                <Text strong>ğŸ“§ è”ç³»é‚®ç®±: </Text>
                <Space wrap>
                  {channel.email.map((email, idx) => (
                    <Tag key={idx} color="success">{email}</Tag>
                  ))}
                </Space>
              </div>
            )}
            
            <Row gutter={[16, 8]} style={{ marginBottom: 16 }}>
              {channel.subscriberCount && (
                <Col xs={12} sm={6}>
                  <div>
                    <Text type="secondary" style={{ fontSize: '12px', display: 'block' }}>è®¢é˜…æ•°</Text>
                    <Text strong>ğŸ‘¥ {formatNumber(channel.subscriberCount)}</Text>
                  </div>
                </Col>
              )}
              {channel.viewCount && (
                <Col xs={12} sm={6}>
                  <div>
                    <Text type="secondary" style={{ fontSize: '12px', display: 'block' }}>æ€»è§‚çœ‹æ•°</Text>
                    <Text strong>ğŸ‘€ {formatNumber(channel.viewCount)}</Text>
                  </div>
                </Col>
              )}
              {channel.videoCount && (
                <Col xs={12} sm={6}>
                  <div>
                    <Text type="secondary" style={{ fontSize: '12px', display: 'block' }}>è§†é¢‘æ•°</Text>
                    <Text strong>ğŸ¬ {formatNumber(channel.videoCount)}</Text>
                  </div>
                </Col>
              )}
              {channel.customUrl && (
                <Col xs={12} sm={6}>
                  <div>
                    <Text type="secondary" style={{ fontSize: '12px', display: 'block' }}>è‡ªå®šä¹‰URL</Text>
                    <Text code>ğŸ”— {channel.customUrl}</Text>
                  </div>
                </Col>
              )}
            </Row>
            
            {channel.description && (
              <div>
                <Paragraph 
                  ellipsis={!isExpanded && hasDescription ? { rows: 3 } : false}
                  style={{ 
                    backgroundColor: '#fafafa', 
                    padding: '12px', 
                    borderRadius: '6px',
                    marginBottom: 0
                  }}
                >
                  {channel.description}
                </Paragraph>
                {hasDescription && (
                  <Button 
                    type="link" 
                    size="small"
                    onClick={() => toggleDescription(index)}
                    style={{ padding: '4px 0', height: 'auto' }}
                  >
                    {isExpanded ? 'æ”¶èµ·' : 'å±•å¼€'}
                  </Button>
                )}
              </div>
            )}
          </Card>
        );
      };
      
      return (
        <div className="container">
          <div className="header">
            <Title level={1} style={{ color: 'white', textAlign: 'center', marginBottom: 8 }}>
              ğŸ¥ YouTube é¢‘é“æœç´¢å·¥å…·
            </Title>
            <Paragraph style={{ color: 'white', textAlign: 'center', opacity: 0.9, fontSize: '18px' }}>
              æœç´¢ YouTube é¢‘é“å¹¶è·å–è”ç³»é‚®ç®±ä¿¡æ¯
            </Paragraph>
          </div>
          
          <Card className="search-card" style={{ marginBottom: 24 }}>
            <Space direction="vertical" size="large" style={{ width: '100%' }}>
              <Row gutter={16} align="bottom">
                <Col xs={24} sm={12} md={8}>
                  <div>
                    <Text strong style={{ marginBottom: 8, display: 'block' }}>æœç´¢å…³é”®è¯</Text>
                    <Input
                      size="large"
                      placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œå¦‚ï¼šç¾é£Ÿåšä¸»ã€ç§‘æŠ€è¯„æµ‹..."
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                      onPressEnter={handleSearch}
                      prefix={<span>ğŸ”</span>}
                    />
                  </div>
                </Col>
                
                <Col xs={24} sm={8} md={6}>
                  <div>
                    <Text strong style={{ marginBottom: 8, display: 'block' }}>æœç´¢ç±»å‹</Text>
                    <Select
                      size="large"
                      value={searchType}
                      onChange={setSearchType}
                      style={{ width: '100%' }}
                    >
                      <Select.Option value="1">ä»…æœ‰é‚®ç®±çš„é¢‘é“</Select.Option>
                      <Select.Option value="2">æ‰€æœ‰é¢‘é“è¯¦æƒ…</Select.Option>
                      <Select.Option value="0">å®Œæ•´æ•°æ®</Select.Option>
                    </Select>
                  </div>
                </Col>
                
                <Col xs={24} sm={4} md={4}>
                  <Button
                    type="primary"
                    size="large"
                    onClick={handleSearch}
                    loading={loading}
                    block
                    className="gradient-btn"
                    style={{ height: '40px' }}
                  >
                    {loading ? 'æœç´¢ä¸­...' : 'ğŸ” æœç´¢'}
                  </Button>
                </Col>
              </Row>
            </Space>
          </Card>
          
          {loading && (
            <Card style={{ textAlign: 'center', marginBottom: 24 }}>
              <Spin size="large" />
              <div style={{ marginTop: 16 }}>
                <Text>ğŸ” æ­£åœ¨æœç´¢ä¸­ï¼Œè¯·ç¨å€™...</Text>
              </div>
            </Card>
          )}
          
          {results && !loading && (
            <Card title={
              <Space>
                <Text strong style={{ fontSize: '18px' }}>
                  æœç´¢ç»“æœ: {results.results?.length || 0} ä¸ªé¢‘é“
                </Text>
                {results.count > 0 && (
                  <Badge 
                    count={`${results.count} ä¸ªæœ‰é‚®ç®±`} 
                    style={{ 
                      backgroundColor: '#52c41a',
                      fontSize: '12px'
                    }} 
                  />
                )}
              </Space>
            }>
              {results.results && results.results.length > 0 ? (
                results.results.map((channel, index) => renderChannelItem(channel, index))
              ) : (
                <div style={{ textAlign: 'center', padding: '60px 20px' }}>
                  <Text type="secondary" style={{ fontSize: '16px' }}>
                    ğŸ˜… æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é¢‘é“ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯
                  </Text>
                </div>
              )}
            </Card>
          )}
        </div>
      );
    }
    
    const container = document.getElementById('root');
    if (ReactDOM.createRoot) {
      // React 18
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    } else {
      // React 17 åŠä»¥ä¸‹
      ReactDOM.render(<App />, container);
    }
  </script>
</body>
</html>